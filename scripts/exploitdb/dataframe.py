import pandas as pd

df = pd.read_csv("../../data/exploitdb/dataset.csv", dtype="string")
df = df.fillna("N/A")
print("Loaded the source CSV! ")
output = []
counter = 1
for i,j in df.iterrows():
    print("Processing row: {} of {}".format(counter, len(df)))
    cves = j["CVE"].split()
    print(cves)
    if len(cves) > 1:
        for cve in cves:
            object = [j["Exploit file path:"], j["Description"], j["ExploitDB ID"],"CVE-"+cve,j["Author"],j["Type"],j["Platform"],j["Date"]]
            output.append(object)
    else:
        cve = "CVE-" + j["CVE"] if not ("n/a") in j["CVE"].lower() else "N/A"
        object = [j["Exploit file path:"], j["Description"], j["ExploitDB ID"],cve,j["Author"],j["Type"],j["Platform"],j["Date"]]
        output.append(object)
    counter = counter + 1

# Output of separate rows CSV
output_df = pd.DataFrame(output, columns = ["Exploit file path:","Description","ExploitDB ID","CVE","Author","Type","Platform","Date"])
print("Exporting dataset with separate rows for multiple CVEs...")
output_df.to_csv("../../data/exploitdb/separate.csv", index=False)

# Output of groupby count CSV

grouped_df = output_df.groupby("CVE").count()
grouped_df = grouped_df.rename(columns={'Exploit file path:':'Count'})
grouped_df = grouped_df.drop(columns=["Description","ExploitDB ID", "Author", "Type", "Platform", "Date"])
grouped_df.to_csv("../../data/exploitdb/grouped.csv")

